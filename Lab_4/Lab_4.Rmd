---
title: "Lab_4"
author: "Abhinav Garg"
date: "2/16/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("/Users/abhi/Documents/UW/Courses/Winter_Quarter_17/INFX_573/Week_6")
```

## Load Data
```{r Load}
data <- read.csv("census_data.csv")
data$income.g50 <- rep(0, nrow(data))
data$income.g50[data$income==" >50K"] <- 1
```

## Exploring Relationships

```{r Exploring}
mod <- glm(income.g50 ~ education + age + sex + race,
data=data[,!colnames(data)%in%"income"], family="binomial")
```

```{r Exploring.a}
summary(mod)
```
## a.) 
The log odds ratio for having a master's degree is 2.91 
and for having 1st to 4th grade education is -0.18

The log odds ratio for having a master's degree is `r exp(2.91)` 
and for having 1st to 4th grade education is `r exp(-0.18)`

The p-value for Master's degree is < 2e -16 hence it is statistically significant but the p-value for 1st - 4th grade education is 0.78371 hence there is more probability that this is by chance. 

`r 0.5/22` is the adjusted alpha level. So we can see that the p-value for Master's is lower than 0.0227273 so it is significant however education 1st -4th is 0.78371 hence it isn't as signficant 

## b.)
P-values for both age and sex are < 2e-16 therefore they are both statistically significant and are practically significant as age and sex do determine a person's income 



## 3
```{r Exploring.b}

x <- data$age
plot(x, data$income.g50, col="blue")
fits <- fitted(mod)
points(x, fits, pch=19, cex=0.3)
```

The predicted outcomes are so variable because although age is on the x-axis the other variables vary and that's why we don't have just one sigmoid line 



## 4
```{r Explore prob}

tab <- table(data$income.g50, fits>=0.25)
(tab[1,2]+tab[2,1])/sum(tab)

tab <- table(data$income.g50, fits>=0.5)
(tab[1,2]+tab[2,1])/sum(tab)

tab <- table(data$income.g50, fits>=0.75)
(tab[1,2]+tab[2,1])/sum(tab)

```

The cutoff with 0.5 has lowest percent error 



## 5
```{r Examine}
library(AUC)
y <- factor(data$income.g50)
rr <- roc(fits, y)
plot(rr)
auc(rr)
```


b. How well does it fit?

The model fits well as the AUC is 0.802 


## 6

```{ Formulate}
mod <- glm(income.g50~.,
data=data[,!colnames(data)%in%c("income")], family="binomial")
```


b. Plot the age by the outcome and the observed predicted probabilities. Do the
predicted probabilities have the same pattern as the other model? Why or why not?
c. Calculate the percent error as before for cutoffs 0.25, 0.5, 0.75. Which cutoff has the
lowest percent error? Does this model perform better than the other model?
d. Plot the ROC and calculate the AUC. Again, does this model out perform the other
model?
Extra credit (5 points): Run a k-fold validation on both models and decide which you
would prefer to use for predicting high income.